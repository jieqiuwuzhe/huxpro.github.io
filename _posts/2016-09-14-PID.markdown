---
layout:     post
title:      "四旋翼基础——一种简单的控制算法思想"
subtitle:   " \"简单的PID实现 \""
date:       2016-09-14 13:57:00
author:     "Root"
header-img: "img/contact-bg.jpg"
catalog: true
tags:
    - UAV
---

> “纵然前路迷茫，纵然天隔一方，纵然我手中的刀刃依然破碎，也无法阻挡我寻找你的道路。————放逐之刃 ”


## 四旋翼飞行器的控制规律及算法实现

四旋翼的基本飞行须参考3个测量量，Pitch，Roll和yaw，然后控制4个电机的转速以达到升降、悬停等动作。其动力学模型复杂，受外界环境影响大，对控制器的自适应和鲁棒性要求都比较高，故控制方法挺多，比如什么反步法（Backstepping），LQ，ADRC。

但是，这里我们采用最简单的——PID，进行一个简单的姿态控制。 

## 电机的不同排布方式

### 十字型

				M1
				|
				|
		M2--------------M3
				|
				|
				M4

要调整pitch，只要改变M1与M4的转速，调整roll，则改变M2与M3的转速，所以可以得到如下控制规律：

		         M1     M2   M3   M4      (H为Hold 保持) 
		正俯仰    +      H    H    - 
		反俯仰    -      H    H    + 
		正横滚    H      +    -    H 
		反横滚    H      -    +    H 
		顺航向    +      -    -    + 
		反航向    -      +    +    - 
		上升      +      +    +    + 
		下降      -      -    -    -

### X型

		M1       M2
		  \     /
		    \ /
		    / \
		  /     \
		M3       M4

这种方式每次需要操作四个电机

“X” 模式的控制规律：

				M1      M2    M3    M4     
		正俯仰   +       +     -     - 
		反俯仰   -       -     +     + 
		正横滚   -       +     -     + 
		反横滚   +       -     +     - 
		顺航向   +       -     -     + 
		反航向   -       +     +     - 
		上升     +       +     +     + 
		下降     -       -     -     -

## 自主悬停

通过PID，调整电机PWM，减小期望与当前姿态的误差，即可实现悬停、航线等复杂动作。

AHRS姿态解算需要可靠，开启电机，强震动下AHRS只要能保证解算的姿态误差幅度在1°以内即可。接着就是一条经典的PID公式：

		u(t) = Kp*[e(t)-e(t-1)] + Ki*e(t) + Kd*[e(t)-2*e(t-1)+e(t-2)] ，

u(t)即为本次给电机的控制量。 

因为是控制3维刚体运动，所以需要当前各轴误差，上次的各轴误差，上上次的各轴误差，还有三套PID参数（也可只用一套参数），可以写成如下矩阵形式：

![Markdown](http://i1.piimg.com/572619/97b197fd970c8b41.jpg)

（字丑，没招，哈哈哈）

Up,Ur,Uy，分别为各轴的控制量；ep,er,ey分别为各轴的姿态误差。


## PS

放假啦，中秋快乐！(*^__^*) 


—— Root 于 2016.9


