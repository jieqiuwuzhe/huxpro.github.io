---
layout:     post
title:      "四旋翼姿态解算"
subtitle:   " \" 四轴姿态解算（采用IMU） \""
date:       2016-12-05 10:57:00
author:     "Root"
header-img: "img/Jilin.jpg"
catalog: true
tags:
    - UAV
---

> “邪恶的外表，其实并不是我的内心。你总是说我困住了你，你会为我停留么？————邪恶小法师 ”

### 一、相关知识储备

1、相关名词：  
**IMU**  ：惯性测量单元 (InertialMeasurement Unit)  
**AHRS** ：姿态航向参考系统(Attitude and Heading Reference System)  
**MARG** ：地磁角速度重力(Magnetic, Angular Rate, and Gravity)  
**MEMS** ：微机电系统(Micro Electrical Mechanical Systems)  
**DOF**  ：自由度维数(Dimension Of Freedom)  
**UAV**  ：无人驾驶飞行器(Unmanned Aerial Vehicle)  
**EKF**  ：扩展卡尔曼滤波(Extended Kalman Filter)  
**UKF**  ：无损卡尔曼滤波(Unscented Kalman Filter)  
**INS**  ：惯性导航系统(Inertial Navigation System)  
**GNSS** ：全球导航卫星系统(Global Navigation Satellite System)  
**CNS**  ：天文导航系统(Celestial Navigation System)  
**VOTL** ：可垂直起降(Vertical Take-off and Landing)  

2、常见导航系统：     
惯性导航、天文导航、卫星导航、路标导航、无线电导航、推算导航、组合导航   

3、两个基本坐标系：  
“地理”坐标系：地球上的“东北天”（ENU）坐标系   
“载体”坐标系：四轴自己的坐标系

![Markdown](http://p1.bpimg.com/572619/08558a19f76ba702.jpg)

在“地理”坐标系中，重力的值始终是（0，0，1g），地磁的值始终是（0，1，x）。这些值就是由放置在四轴上的传感器测量出来的。

4、两个坐标系之间的转化   
“地理”坐标系和“载体”坐标系是两个不同的坐标系，需要转化。转化的方法就是坐标系的转换，目前有三种方式：四元数（q0123）、欧拉角（yaw（Z轴）/ pitch（Y轴）/roll（X轴）属于其中一种旋转顺序Z-Y-Xà航空次序欧拉角）、方向余弦矩阵（9个系数）。

6、所谓的姿态，就是公式+系数。比如：欧拉角公式和欧拉角的系数（翻滚、倾仰、偏航）

7、姿态的数据来源有5个：重力、地磁、陀螺仪、加速度计、电子罗盘。其中前两个来自“地理”坐标系，后三个来自“载体”坐标系。

### 二、导航

导航的基本原则就是保证两个基本坐标系的正确转化，没有误差。只有实现了这个原则，载体才可以在自己的坐标系中完成一系列动作而被转换到地理坐标系中看起来是正确的。为了达到这个目标，需要对两个坐标系进行实时的标定和修正。

因为坐标系有三个轴，偏航yaw修正由电子罗盘（基于载体）、地磁（基于地理）对比修正误差补偿得到。倾仰pitch和翻滚roll上的修正由加速度计（基于载体）、重力（基于地理）对比修正误差得到。在完成了基本原则的基础之后，即保证两个坐标系的正确转化后，利用基于载体上的陀螺仪进行积分运算，得到基于载体坐标系的姿态数据，经过一系列PID控制，给出控制量，完成基于载体坐标系上的稳定控制后，反应到地理坐标系上的稳定控制，从而达到我们观察到的定高、偏航、翻滚、倾仰等动作。

可以看出，导航姿态从理论上讲只用陀螺仪是可以完成任务的。但是由于陀螺仪在积分过程中会产生误差累计，外加上白噪声、温度偏差等会造成导航姿态的解算随着时间的流逝而逐渐增加。所以就需要用加速度计在水平面对重力进行比对和补偿，用来修正陀螺仪的垂直误差。但是对于竖直轴上的旋转，加速度计是无能为力的，此时用的是电子罗盘。他也可以测量出水平面内的地磁方向用来修正陀螺仪的水平误差。通过这两个器件的修正补偿，使得陀螺仪更加稳定、可靠的工作。

加速度计在地球上测量的是重力加速度，如果载体沿着z轴旋转，加速度计是无法感知他的运动的；类似的，电子罗盘测量的是地球上的磁场方向，如果载体沿着y轴旋转，电子罗盘同样也是无法感知他的运动的。因此，加速度计和电子罗盘只能得到2维的角度关系，通过某种方式的融合，可以得到正确的三维姿态信息。

在单位时间内的位移被定义为速度，速度有线速度和角速度之分，分别对应两种传感器测量这两种不同的速度：线速度传感器（加速度计）、角速度传感器（陀螺仪）。所以，陀螺仪是用来测量角速度的，用于坐标系的旋转，也就是导航姿态。加速度计只能测量线速度，最典型的例子就是重力加速度，如果加上水平坐标系上的加速度，形成合力F产生a。考虑一个导弹，他的飞行速度由加速度计来测量而飞行过程中的转体姿态由陀螺仪来测量。

当我们把加速度计拿在手上随意转动时，我们看的是重力加速度在三个轴上的分量值，无法直观的观察到三个轴上的加速度分别是多少。为了实现这样一个目的(即可以看到每个轴上的真实加速度)，我们需要一个旋转矩阵，这个矩阵的作用就是把放置在载体坐标系上的加速度计值转换到参考坐标系中，在参考坐标系中，三个轴上的值始终都是（0，0，1）。所以当我们把加速度计以任意角度固定在空间中时，无论加速度计的三个轴的值是多少，当经过旋转矩阵变换后，在参考坐标戏中输出的值始终都是（0，0，1），这表明在参考坐标系中，物体在x和y轴上是没有加速度的，只有在z轴上存在重力加速度。但是这里又存在一个问题，既然z轴的输出是1，就是说存在加速度，物体应该运动起来才对。但是这里物体并没有运动。为什么输出是1呢？这涉及到加速度计的设计问题：加速度计测量加速度是通过比力来测量，而不是通过加速度。通过想象一个盒子中的小球就就可以明白。加速度计只有在自由落体时，其输出为0。

举例：对于一个人来讲，要从四平到长春，必须满足两个要求：   
1、你必须有张吉林省地图，并且知道四平和长春的位置。   
2、你必须带有方向导航系统，实时更新你目前的朝向。   
对应到飞行导航上面，长春的位置对应“地理”坐标系，四平的位置对应“载体”坐标系。目的就是让这个两个坐标系被正确转化和标定。这部分工作交给加速度计和电子罗盘处理。至于你具体是走过去，骑自行车去，乘公交去还是做出租车过去，对应在飞行导航上面的话，是利用的陀螺仪通过积分作用确定自己的动态姿态。

（再挖一个坑，未完待续。。。）



—— Root 于 2016.12


